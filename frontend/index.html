<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate-Aware GPS Navigator</title>
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(90deg, #2c3e50, #34495e, #3498db, #2980b9);
            background-size: 300% 300%;
            animation: gradientShift 8s ease infinite;
            color: white;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1000;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 12px;
            margin-right: 20px;
            position: relative;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 50%;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 300;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .container {
            display: flex;
            height: calc(100vh - 140px);
            gap: 25px;
            padding: 25px;
        }

        .control-panel {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 20px;
            padding: 30px;
            width: 380px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.4);
            overflow-y: auto;
        }

        .control-panel h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.6em;
            text-align: center;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 400;
            letter-spacing: 1px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: #34495e;
            font-weight: 500;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-group input {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            color: #2c3e50;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
        }

        .input-group input.error {
            border-color: #e74c3c;
            background: linear-gradient(145deg, #fff5f5, #ffe8e8);
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.85em;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .hazard-toggles {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
        }

        .hazard-toggles h3 {
            color: #e74c3c;
            margin-bottom: 20px;
            font-size: 1.1em;
            text-align: center;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #f1f3f4;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .toggle-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.15);
            border-color: #e74c3c;
        }

        .toggle-item input[type="checkbox"] {
            width: auto;
            margin-right: 15px;
            transform: scale(1.2);
            accent-color: #e74c3c;
        }

        .toggle-item label {
            color: #2c3e50;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
            font-size: 0.95em;
        }

        .map-style-selector {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .map-style-selector h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .style-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .style-btn {
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
            font-weight: 500;
        }

        .style-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .style-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .calculate-btn:active {
            transform: translateY(-1px);
        }

        .calculate-btn:disabled {
            background: linear-gradient(45deg, #bdc3c7, #95a5a6);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .map-container {
            flex: 1;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .overlay-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .overlay-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .overlay-control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8em;
            color: #34495e;
        }

        .overlay-control input[type="range"] {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
        }

        .overlay-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(52, 152, 219, 0.3);
        }

        .route-info {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid #dee2e6;
            display: none;
        }

        .route-info.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .route-info h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .route-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hazards-list {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .hazards-list h4 {
            color: #e74c3c;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hazard-item {
            background: linear-gradient(145deg, #fff5f5, #ffe8e8);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            font-size: 0.9em;
            color: #c0392b;
            border: 1px solid #fadbd8;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 25px;
            color: #3498db;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #ecf0f1;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            background: linear-gradient(145deg, #d5f4e6, #abebc6);
            color: #27ae60;
            padding: 18px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
            font-weight: 500;
            border: 1px solid #82e0aa;
            display: none;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.1);
        }

        .success-message.show {
            display: block;
            animation: bounceIn 0.6s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .examples {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .examples h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .example-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .example-link {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #e9ecef;
            color: #3498db;
            text-decoration: none;
            font-size: 0.85em;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .example-link:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .control-panel {
                width: 100%;
                order: 2;
            }
            
            .map-container {
                order: 1;
                height: 400px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <div class="logo-icon"></div>
            <h1>Climate-Aware GPS Navigator</h1>
        </div>
        <p>Intelligent routing through environmental hazards</p>
    </div>

    <div class="container">
        <div class="control-panel">
            <h2>Route Planning</h2>
            
            <div class="examples">
                <h4>Quick Examples</h4>
                <div class="example-links">
                    <span class="example-link" onclick="setExample('New York, NY', 'Boston, MA')">NYC → Boston</span>
                    <span class="example-link" onclick="setExample('Los Angeles, CA', 'San Francisco, CA')">LA → SF</span>
                    <span class="example-link" onclick="setExample('Miami, FL', 'Orlando, FL')">Miami → Orlando</span>
                    <span class="example-link" onclick="setExample('Seattle, WA', 'Portland, OR')">Seattle → Portland</span>
                </div>
            </div>
            
            <div class="input-group">
                <label for="origin">Origin</label>
                <input type="text" id="origin" placeholder="Enter origin address or city" value="">
                <div class="error-message" id="origin-error">Please enter a valid origin address</div>
            </div>
            
            <div class="input-group">
                <label for="destination">Destination</label>
                <input type="text" id="destination" placeholder="Enter destination address or city" value="">
                <div class="error-message" id="destination-error">Please enter a valid destination address</div>
            </div>
            
            <div class="map-style-selector">
                <h3>Map Style</h3>
                <div class="style-buttons">
                    <button class="style-btn active" onclick="changeMapStyle('satellite')">Satellite</button>
                    <button class="style-btn" onclick="changeMapStyle('terrain')">Terrain</button>
                    <button class="style-btn" onclick="changeMapStyle('streets')">Streets</button>
                    <button class="style-btn" onclick="changeMapStyle('dark')">Dark</button>
                </div>
            </div>
            
            <div class="hazard-toggles">
                <h3>Hazard Overlays</h3>
                <div class="toggle-item">
                    <input type="checkbox" id="flood-toggle" checked>
                    <label for="flood-toggle">Flood Zones</label>
                </div>
                <div class="toggle-item">
                    <input type="checkbox" id="weather-toggle" checked>
                    <label for="weather-toggle">Weather Alerts</label>
                </div>
                <div class="toggle-item">
                    <input type="checkbox" id="river-toggle" checked>
                    <label for="river-toggle">River Gauges</label>
                </div>
            </div>
            
            <button class="calculate-btn" id="calculate-btn" onclick="calculateRoute()">
                Calculate Route
            </button>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Calculating your safe route...</p>
            </div>
            
            <div class="success-message" id="success-message">
                Route calculated successfully
            </div>
            
            <div class="route-info" id="route-info">
                <h3>Route Information</h3>
                <div class="route-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="distance">0 km</div>
                        <div class="stat-label">Distance</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="duration">0 min</div>
                        <div class="stat-label">Duration</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="risk-score">0%</div>
                        <div class="stat-label">Risk Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="hazards-avoided">0</div>
                        <div class="stat-label">Hazards Avoided</div>
                    </div>
                </div>
                
                <div class="hazards-list">
                    <h4>Hazards Avoided</h4>
                    <div id="hazards-content">
                        <div class="hazard-item">No hazards detected on this route</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="map-overlay">
                <div class="overlay-title">3D Controls</div>
                <div class="overlay-controls">
                    <div class="overlay-control">
                        <span>Pitch:</span>
                        <input type="range" id="pitch-control" min="0" max="60" value="45" step="5">
                    </div>
                    <div class="overlay-control">
                        <span>Bearing:</span>
                        <input type="range" id="bearing-control" min="-180" max="180" value="0" step="15">
                    </div>
                    <div class="overlay-control">
                        <span>Terrain:</span>
                        <input type="range" id="terrain-control" min="0" max="100" value="50" step="10">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Map style configurations
        const mapStyles = {
            satellite: {
                style: 'https://basemaps.cartocdn.com/gl/satellite-gl-style/style.json',
                pitch: 45,
                bearing: 0,
                terrain: 50
            },
            terrain: {
                style: 'https://basemaps.cartocdn.com/gl/terrain-gl-style/style.json',
                pitch: 60,
                bearing: 0,
                terrain: 100
            },
            streets: {
                style: 'https://basemaps.cartocdn.com/gl/streets-gl-style/style.json',
                pitch: 30,
                bearing: 0,
                terrain: 25
            },
            dark: {
                style: 'https://basemaps.cartocdn.com/gl/dark-gl-style/style.json',
                pitch: 35,
                bearing: 0,
                terrain: 40
            }
        };

        let currentMapStyle = 'satellite';

        // Initialize MapLibre GL JS map with enhanced 3D features
        const map = new maplibregl.Map({
            container: 'map',
            style: mapStyles.satellite.style,
            center: [-98.5795, 39.8283], // Center of USA
            zoom: 4,
            pitch: 45,
            bearing: 0,
            antialias: true,
            preserveDrawingBuffer: true
        });

        // Add enhanced navigation controls
        map.addControl(new maplibregl.NavigationControl({
            visualizePitch: true,
            showZoom: true,
            showCompass: true
        }), 'top-right');

        // Add fullscreen control
        map.addControl(new maplibregl.FullscreenControl(), 'top-right');

        // Add geolocate control
        map.addControl(new maplibregl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true,
            showUserHeading: true
        }), 'top-right');

        // Global variables for route data
        let currentRoute = null;
        let originCoordinates = null;
        let destinationCoordinates = null;

        // Function to change map style
        function changeMapStyle(style) {
            // Update active button
            document.querySelectorAll('.style-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Change map style
            map.setStyle(mapStyles[style].style);
            currentMapStyle = style;
            
            // Wait for style to load, then restore 3D settings
            map.once('style.load', () => {
                // Restore 3D settings
                map.setPitch(mapStyles[style].pitch);
                map.setBearing(mapStyles[style].bearing);
                
                // Add terrain if available
                if (map.getSource('mapbox-terrain')) {
                    map.setTerrain({ 'source': 'mapbox-terrain', 'exaggeration': mapStyles[style].terrain / 50 });
                }
                
                // Re-add route if exists
                if (currentRoute) {
                    setTimeout(() => drawRoute(currentRoute), 100);
                }
            });
        }

        // Function to set example routes
        function setExample(origin, destination) {
            document.getElementById('origin').value = origin;
            document.getElementById('destination').value = destination;
            // Clear any previous errors
            clearErrors();
        }

        // Function to clear error states
        function clearErrors() {
            document.getElementById('origin').classList.remove('error');
            document.getElementById('destination').classList.remove('error');
            document.getElementById('origin-error').classList.remove('show');
            document.getElementById('destination-error').classList.remove('show');
        }

        // Function to validate inputs
        function validateInputs() {
            clearErrors();
            let isValid = true;
            
            const origin = document.getElementById('origin').value.trim();
            const destination = document.getElementById('destination').value.trim();
            
            if (!origin) {
                document.getElementById('origin').classList.add('error');
                document.getElementById('origin-error').classList.add('show');
                isValid = false;
            }
            
            if (!destination) {
                document.getElementById('destination').classList.add('error');
                document.getElementById('destination-error').classList.add('show');
                isValid = false;
            }
            
            return isValid;
        }

        // Function to geocode address (mock implementation)
        async function geocodeAddress(address) {
            // In a real application, you would use a geocoding service like:
            // - Google Maps Geocoding API
            // - Mapbox Geocoding API
            // - OpenStreetMap Nominatim
            
            // For demo purposes, we'll use some common coordinates
            const mockCoordinates = {
                'new york, ny': [-74.0060, 40.7128],
                'boston, ma': [-71.0589, 42.3601],
                'los angeles, ca': [-118.2437, 34.0522],
                'san francisco, ca': [-122.4194, 37.7749],
                'miami, fl': [-80.1918, 25.7617],
                'orlando, fl': [-81.3792, 28.5383],
                'seattle, wa': [-122.3321, 47.6062],
                'portland, or': [-122.6765, 45.5152],
                'dallas, tx': [-96.7970, 32.7767],
                'houston, tx': [-95.3698, 29.7604],
                'chicago, il': [-87.6298, 41.8781],
                'phoenix, az': [-112.0740, 33.4484],
                'philadelphia, pa': [-75.1652, 39.9526],
                'san antonio, tx': [-98.4936, 29.4241],
                'san diego, ca': [-117.1611, 32.7157]
            };
            
            const normalizedAddress = address.toLowerCase().trim();
            
            // Check if we have mock coordinates for this address
            if (mockCoordinates[normalizedAddress]) {
                return mockCoordinates[normalizedAddress];
            }
            
            // If no mock coordinates, generate random coordinates within reasonable bounds
            // This simulates a real geocoding service
            const lat = 25 + Math.random() * 25; // Between 25-50 degrees latitude
            const lng = -125 + Math.random() * 65; // Between -125 to -60 degrees longitude
            
            return [lng, lat];
        }

        // Function to calculate route
        async function calculateRoute() {
            if (!validateInputs()) {
                return;
            }
            
            const loading = document.getElementById('loading');
            const successMessage = document.getElementById('success-message');
            const routeInfo = document.getElementById('route-info');
            const calculateBtn = document.getElementById('calculate-btn');
            
            // Show loading and disable button
            loading.classList.add('show');
            successMessage.classList.remove('show');
            routeInfo.classList.remove('show');
            calculateBtn.disabled = true;
            
            try {
                // Get addresses
                const originAddress = document.getElementById('origin').value.trim();
                const destinationAddress = document.getElementById('destination').value.trim();
                
                // Geocode addresses
                originCoordinates = await geocodeAddress(originAddress);
                destinationCoordinates = await geocodeAddress(destinationAddress);
                
                // Simulate API call delay
                setTimeout(() => {
                    // Hide loading
                    loading.classList.remove('show');
                    
                    // Generate mock route data based on coordinates
                    const distance = calculateDistance(originCoordinates, destinationCoordinates);
                    const duration = Math.round(distance * 1.2); // Rough estimate: 1.2 min per km
                    const riskScore = Math.floor(Math.random() * 40) + 10; // Random risk between 10-50%
                    const hazardsAvoided = Math.floor(Math.random() * 4) + 1; // Random hazards between 1-4
                    
                    currentRoute = {
                        distance: Math.round(distance),
                        duration: duration,
                        riskScore: riskScore,
                        hazardsAvoided: hazardsAvoided,
                        hazards: generateMockHazards(hazardsAvoided),
                        origin: originAddress,
                        destination: destinationAddress,
                        originCoords: originCoordinates,
                        destinationCoords: destinationCoordinates
                    };
                    
                    // Show success message
                    successMessage.classList.add('show');
                    
                    // Update route information
                    updateRouteInfo(currentRoute);
                    
                    // Show route info
                    setTimeout(() => {
                        routeInfo.classList.add('show');
                    }, 500);
                    
                    // Draw route on map
                    drawRoute(currentRoute);
                    
                    // Re-enable button
                    calculateBtn.disabled = false;
                    
                }, 2000);
                
            } catch (error) {
                console.error('Error calculating route:', error);
                loading.classList.remove('show');
                calculateBtn.disabled = false;
                alert('Error calculating route. Please try again.');
            }
        }

        // Function to calculate distance between two coordinates (Haversine formula)
        function calculateDistance(coord1, coord2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (coord2[1] - coord1[1]) * Math.PI / 180;
            const dLon = (coord2[0] - coord1[0]) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(coord1[1] * Math.PI / 180) * Math.cos(coord2[1] * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Function to generate mock hazards
        function generateMockHazards(count) {
            const hazardTypes = [
                "FEMA flood zone",
                "Weather warning",
                "River flood stage",
                "Storm surge area",
                "Wildfire risk zone",
                "Ice storm warning",
                "Tornado watch area",
                "Flash flood warning"
            ];
            
            const selectedHazards = [];
            for (let i = 0; i < count; i++) {
                const randomHazard = hazardTypes[Math.floor(Math.random() * hazardTypes.length)];
                if (!selectedHazards.includes(randomHazard)) {
                    selectedHazards.push(randomHazard);
                }
            }
            
            return selectedHazards;
        }

        // Function to update route information display
        function updateRouteInfo(route) {
            document.getElementById('distance').textContent = route.distance + ' km';
            document.getElementById('duration').textContent = route.duration + ' min';
            document.getElementById('risk-score').textContent = route.riskScore + '%';
            document.getElementById('hazards-avoided').textContent = route.hazardsAvoided;
            
            // Update hazards list
            const hazardsContent = document.getElementById('hazards-content');
            hazardsContent.innerHTML = '';
            
            if (route.hazards.length === 0) {
                const noHazards = document.createElement('div');
                noHazards.className = 'hazard-item';
                noHazards.textContent = 'No hazards detected on this route';
                hazardsContent.appendChild(noHazards);
            } else {
                route.hazards.forEach(hazard => {
                    const hazardItem = document.createElement('div');
                    hazardItem.className = 'hazard-item';
                    hazardItem.textContent = hazard;
                    hazardsContent.appendChild(hazardItem);
                });
            }
        }

        // Function to draw route on map with enhanced 3D effects
        function drawRoute(route) {
            // Remove existing route if any
            if (map.getSource('route')) {
                map.removeLayer('route');
                map.removeSource('route');
            }
            
            // Remove existing markers
            const existingMarkers = document.querySelectorAll('.maplibregl-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            // Add route line with enhanced styling
            map.addSource('route', {
                type: 'geojson',
                data: {
                    type: 'Feature',
                    properties: {},
                    geometry: {
                        type: 'LineString',
                        coordinates: [
                            route.originCoords,
                            route.destinationCoords
                        ]
                    }
                }
            });
            
            // Add route line with 3D effect
            map.addLayer({
                id: 'route',
                type: 'line',
                source: 'route',
                layout: {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                paint: {
                    'line-color': '#3498db',
                    'line-width': 8,
                    'line-opacity': 0.9,
                    'line-blur': 2
                }
            });
            
            // Add route glow effect
            map.addLayer({
                id: 'route-glow',
                type: 'line',
                source: 'route',
                layout: {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                paint: {
                    'line-color': '#3498db',
                    'line-width': 20,
                    'line-opacity': 0.1,
                    'line-blur': 10
                }
            });
            
            // Add markers for origin and destination with enhanced styling
            addEnhancedMarker(route.originCoords, route.origin, '#3498db', 'origin');
            addEnhancedMarker(route.destinationCoords, route.destination, '#e74c3c', 'destination');
            
            // Fit map to show the entire route with 3D perspective
            const bounds = new maplibregl.LngLatBounds();
            bounds.extend(route.originCoords);
            bounds.extend(route.destinationCoords);
            map.fitBounds(bounds, { 
                padding: 80,
                pitch: mapStyles[currentMapStyle].pitch,
                bearing: mapStyles[currentMapStyle].bearing
            });
        }

        // Function to add enhanced markers with 3D effects
        function addEnhancedMarker(coordinates, label, color, type) {
            const el = document.createElement('div');
            el.className = 'enhanced-marker';
            el.style.width = '30px';
            el.style.height = '30px';
            el.style.borderRadius = '50%';
            el.style.background = `radial-gradient(circle at 30% 30%, ${color}, ${color}dd)`;
            el.style.border = '4px solid white';
            el.style.boxShadow = `0 4px 20px ${color}80, 0 0 0 2px ${color}40`;
            el.style.cursor = 'pointer';
            el.style.transition = 'all 0.3s ease';
            
            // Add hover effect
            el.addEventListener('mouseenter', () => {
                el.style.transform = 'scale(1.2)';
                el.style.boxShadow = `0 6px 25px ${color}, 0 0 0 3px ${color}60`;
            });
            
            el.addEventListener('mouseleave', () => {
                el.style.transform = 'scale(1)';
                el.style.boxShadow = `0 4px 20px ${color}80, 0 0 0 2px ${color}40`;
            });
            
            new maplibregl.Marker(el)
                .setLngLat(coordinates)
                .setPopup(new maplibregl.Popup({
                    closeButton: false,
                    className: 'enhanced-popup'
                }).setHTML(`<h3 style="color: ${color}; margin: 0 0 5px 0;">${label}</h3><p style="margin: 0; color: #666;">${type === 'origin' ? 'Starting point' : 'Destination'}</p>`))
                .addTo(map);
        }

        // Initialize map when loaded
        map.on('load', () => {
            console.log('Enhanced 3D map loaded successfully');
            
            // Set initial 3D settings
            map.setPitch(mapStyles[currentMapStyle].pitch);
            map.setBearing(mapStyles[currentMapStyle].bearing);
            
            // Add terrain if available
            if (map.getSource('mapbox-terrain')) {
                map.setTerrain({ 'source': 'mapbox-terrain', 'exaggeration': mapStyles[currentMapStyle].terrain / 50 });
            }
        });

        // Add 3D control event listeners
        document.getElementById('pitch-control').addEventListener('input', (e) => {
            map.setPitch(parseInt(e.target.value));
        });

        document.getElementById('bearing-control').addEventListener('input', (e) => {
            map.setBearing(parseInt(e.target.value));
        });

        document.getElementById('terrain-control').addEventListener('input', (e) => {
            if (map.getSource('mapbox-terrain')) {
                map.setTerrain({ 'source': 'mapbox-terrain', 'exaggeration': parseInt(e.target.value) / 50 });
            }
        });

        // Add enter key support for inputs
        document.getElementById('origin').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('destination').focus();
            }
        });

        document.getElementById('destination').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateRoute();
            }
        });

        // Add map interaction enhancements
        map.on('mousemove', (e) => {
            // Add subtle tilt on mouse movement for more immersive feel
            if (e.buttons === 1) { // Left mouse button pressed
                const center = map.getCenter();
                const deltaLng = e.lngLat.lng - center.lng;
                const deltaLat = e.lngLat.lat - center.lat;
                
                // Subtle bearing adjustment based on mouse movement
                const newBearing = map.getBearing() + deltaLng * 0.1;
                map.setBearing(newBearing);
            }
        });

        // Add smooth zoom animation
        map.on('zoom', () => {
            // Adjust pitch based on zoom level for better 3D effect
            const zoom = map.getZoom();
            if (zoom > 8) {
                const newPitch = Math.min(60, 30 + (zoom - 8) * 3);
                map.setPitch(newPitch);
            }
        });
    </script>
</body>
</html> 